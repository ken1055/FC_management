# 🔍 Railway デプロイ確認チェックリスト

## ステップ 1: Railway ダッシュボード確認

### 1.1 デプロイ状況確認

- [ ] Railway ダッシュボードにログイン完了
- [ ] プロジェクトが表示されている
- [ ] 「Deployments」タブで最新デプロイが「Success」になっている
- [ ] エラーログが表示されていない

### 1.2 URL 取得

- [ ] 「Settings」→「Domains」でアプリケーション URL を確認
- [ ] URL をコピー（形式：`https://your-project-name.up.railway.app`）

## ステップ 2: 環境変数確認

### 2.1 必須変数チェック

- [ ] `SESSION_SECRET` が設定されている（32 文字以上）
- [ ] `NODE_ENV` が `production` に設定されている
- [ ] その他の環境変数が正しく設定されている

### 2.2 環境変数生成（未設定の場合）

```bash
# SESSION_SECRET 生成
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

## ステップ 3: アプリケーション動作確認

### 3.1 基本アクセステスト

- [ ] ブラウザで Railway URL にアクセス
- [ ] ログイン画面が正常に表示される
- [ ] エラーページが表示されない

### 3.2 ログイン機能テスト

- [ ] 初期アカウント（admin/admin）でログイン成功
- [ ] 管理者ダッシュボードが表示される
- [ ] メニューが正常に動作する

### 3.3 基本機能テスト

- [ ] 代理店一覧ページにアクセス可能
- [ ] ユーザー一覧ページにアクセス可能
- [ ] 設定ページにアクセス可能
- [ ] ログアウト機能が動作する

## ステップ 4: ログ・メトリクス確認

### 4.1 アプリケーションログ

- [ ] 「Metrics」タブでログを確認
- [ ] データベース初期化完了メッセージを確認
- [ ] サーバー起動メッセージを確認
- [ ] エラーメッセージがないことを確認

### 4.2 正常ログの例

```
=== 環境変数デバッグ ===
DATABASE_URL: 設定済み または 未設定
RAILWAY_ENVIRONMENT_NAME: production
NODE_ENV: production

=== データベース初期化開始 ===
Railway: データディレクトリを作成しました: /app/data
ローカルDB初期化完了
デフォルト管理者アカウント作成完了
Server running on port 3000
```

## ステップ 5: データベース確認

### 5.1 SQLite の場合

- [ ] ボリューム設定（`/app/data`）が正常
- [ ] データベースファイルが作成されている
- [ ] 初期管理者アカウントが作成されている

### 5.2 PostgreSQL の場合

- [ ] 「Data」タブで PostgreSQL サービスが稼働中
- [ ] `DATABASE_URL` が環境変数に設定されている
- [ ] データベース接続エラーがない

## ステップ 6: セキュリティ確認

### 6.1 初期設定変更

- [ ] 管理者パスワードを初期値（admin）から変更
- [ ] 強力なパスワード（8 文字以上）を設定
- [ ] `ADMIN_PROMOTION_PASS` を設定（推奨）

## トラブルシューティング

### よくある問題と解決方法

#### 1. 「500 Internal Server Error」が表示される

**原因**: 環境変数 `SESSION_SECRET` が未設定
**解決方法**:

1. Railway ダッシュボード → Variables タブ
2. `SESSION_SECRET` を追加（32 文字以上のランダム文字列）
3. 自動再デプロイを待つ

#### 2. ログイン画面が表示されない

**原因**: デプロイが完了していない
**解決方法**:

1. Deployments タブでデプロイ状況を確認
2. ログでエラーメッセージを確認
3. 必要に応じて再デプロイ実行

#### 3. データベース接続エラー

**原因**: データベース設定の問題
**解決方法**:

1. PostgreSQL 使用時: `DATABASE_URL` を確認
2. SQLite 使用時: ボリューム設定を確認
3. ログでデータベース初期化メッセージを確認

#### 4. ファイルアップロードが失敗

**原因**: ボリューム設定の問題
**解決方法**:

1. `railway.toml` のボリューム設定を確認
2. `/app/data` ディレクトリの権限を確認

## 確認完了

全てのチェック項目が完了したら、デプロイは正常に完了しています！

### 次のステップ

1. 管理者パスワードの変更
2. 代理店データの登録
3. ユーザーアカウントの作成
4. メール設定（オプション）
5. カスタムドメイン設定（オプション）
